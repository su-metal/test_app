# フォルダ構成と依存関係（現状）

最終更新: 自動生成（本リポジトリの現在内容に基づく）

## 概要

- モノレポ: pnpm Workspaces（`apps/*`, `packages/*`）
- アプリ: Next.js(App Router) 2 本（`store`/`user`）
- 共通: `@supabase/supabase-js`、Tailwind CSS 4、TypeScript strict
- 開発起動: `pnpm dev`（store: `:3001`、user: `:3002`）

## ルート構成（主要）

```
.
├─ apps/
│  ├─ store/    # 店側アプリ（Next.js）
│  └─ user/     # ユーザー側アプリ（Next.js）
├─ packages/
│  └─ shared/   # 共有ユーティリティ（現状プレースホルダ）
├─ docs/        # ドキュメント群（本ファイル含む）
├─ document/    # 参考ドキュメント（外部由来の複製等）
├─ scripts/     # ユーティリティスクリプト（seed 等）
└─ supabase/    # バックアップ等の補助資材
```

### `scripts/`

- `seed-stores-locations.mjs`: 店舗の位置情報シード

### `supabase/`

- `backup/backup_*.dump`: バックアップファイル

## apps/store（店側）

```
apps/store/
├─ public/
├─ src/
│  ├─ app/
│  │  ├─ layout.tsx        # env ブリッジ/グローバルスタイル
│  │  ├─ page.tsx          # 店 UI 中核（注文一覧・受け渡し）
│  │  ├─ SupabaseBoot.tsx  # Supabase クライアント遅延生成
│  │  └─ analytics/page.tsx
│  ├─ lib/
│  │  └─ storage/upload.ts # 画像アップロード
│  ├─ types/
│  │  ├─ window.d.ts
│  │  └─ window.supabase.d.ts
│  └─ photo/ ...           # 店舗/商品画像（開発用）
└─ package.json
```

### 依存関係（store）

- runtime: `next@15.5.4`, `react@19.1.0`, `react-dom@19.1.0`
- dev: `eslint@^9`、`eslint-config-next@15.5.4`、`typescript@^5.9.3`、`tailwindcss@^4.1.14`、`postcss@^8.5.6`、`autoprefixer@^10.4.21`、型定義（@types/node/react/react-dom）

## apps/user（ユーザー側）

```
apps/user/
├─ public/
├─ src/
│  ├─ app/
│  │  ├─ layout.tsx
│  │  ├─ page.tsx                  # ユーザーフロー中核
│  │  ├─ checkout/{success,cancel,complete}/page.tsx
│  │  └─ api/
│  │     ├─ checkout/embedded/route.ts
│  │     ├─ create-checkout-session/route.ts
│  │     └─ stripe/{checkout,create-checkout-session,create-intent,fulfill,pay-with-saved}/route.ts
│  ├─ components/
│  │  ├─ MapView.tsx
│  │  └─ PickupTimeSelector.tsx
│  └─ lib/
│     ├─ supabase.ts
│     └─ pickupSlots.ts
└─ package.json
```

### 依存関係（user）

- runtime: `next@15.5.4`, `react@19.1.0`, `react-dom@19.1.0`
- 決済/地図: `stripe@^19.1.0`、`@stripe/{react-stripe-js,stripe-js}`、`leaflet@^1.9.4`、`react-leaflet@^5.0.0`
- dev: `eslint@^9`、`eslint-config-next@15.5.4`、`typescript@^5.9.3`、`tailwindcss@^4.1.14`、`postcss@^8.5.6`、`autoprefixer@^10.4.21`、型定義（@types/node/react/react-dom）

## packages/shared

- 概要: 共有ユーティリティ用パッケージ（現状中身なし）

## ルート package.json

- workspaces: `apps/*`, `packages/*`
- scripts:
  - `dev`: `store` と `user` を並行起動（`concurrently` 利用）
  - `dev:store`, `dev:user`: 個別起動
  - `seed:stores:locations`: シード実行
- dependencies: `@supabase/supabase-js@^2.74.0`, `leaflet@^1.9.4`
- devDependencies: `typescript@^5.9.3`, `tailwindcss@^4.1.14`, `postcss@^8.5.6`, `autoprefixer@^10.4.21`, `concurrently@^9.2.1`, 型定義一式

## 備考

- Next.js の `.next/` と各 `node_modules/` は省略しています。
- Supabase の接続情報は各アプリの `.env.local` に配置（`NEXT_PUBLIC_SUPABASE_URL`, `NEXT_PUBLIC_SUPABASE_ANON_KEY`, `NEXT_PUBLIC_STORE_ID`）。
- 仕様との表記整合は docs の要件書に準拠。差分は実装側で `TODO(req v2): ...` を付与してください。

